<?php

/**
* Form to add or update categories
*
*/

$usehtmleditor = can_use_html_editor();
$symboloptions = magtest_get_symbols($magtest, $renderingpathbase);

print_heading(get_string($cmd, 'magtest'));
print_box_start();

?>
<center>
<script type="text/javascript" >
function updaterenderer(n, selector){
    imgpath = '<?php echo $renderingpathbase ?>'+selector.options[selector.selectedIndex].value;
    imgid = 'symbol_img' + n;
    imgobj = document.getElementById(imgid);
    imgobj.src = imgpath;
}
</script>
<form name="categories" method="post" action="<?php echo $CFG->wwwroot ?>/mod/magtest/view.php">
<input type="hidden" name="id" value="<?php p($cm->id) ?>" /> 
<input type="hidden" name="what" value="do<?php p($cmd) ?>" /> 
<?php
if ($cmd == 'updatecategory'){
?>
<input type="hidden" name="catid" value="<?php p($catid) ?>" /> 
<?php
}
?>
<table width="80%">
<?php
for($i = 0 ; $i < $howmany ; $i++){
?>
    <tr valign="top">
        <td align="right"><b><?php print_string('name') ?>:</b></td>
        <td align="left">
            <input type="text" name="name[]" value="<?php echo htmlentities(@$categories[$i]->name, ENT_QUOTES, 'UTF-8') ?>" size="120" maxlength="255" />
        </td>
    </tr>
    <tr valign="top">
        <td align="right"><b><?php print_string('symbol', 'magtest') ?>:</b></td>
        <td align="left">
            <?php
            $symbolpath = (!empty($categories[$i]->symbol)) ? $CFG->wwwroot.'/mod/magtest/pix/symbols/'. $categories[$i]->symbol : $CFG->wwwroot.'/mod/magtest/pix/symbols/blank.gif' ;
            choose_from_menu_nested($symboloptions, 'symbol[]', @$categories[$i]->symbol, 'choose', "updaterenderer($i, this)");
            ?>
            <img src="<?php echo $symbolpath ?>" id="symbol_img<?php echo $i ?>" align="bottom" />
        </td>
    </tr>
    <tr valign="top">
        <td align="right"><b><?php print_string('description') ?>:</b></td>
        <td align="left">
        <?php
           print_textarea($usehtmleditor, 5, 60, 595, 400, 'description[]', @$categories[$i]->description);
    
           if ($usehtmleditor) {
               echo '<input type="hidden" name="format[]" value="'.FORMAT_HTML.'" />';
               $nohtmleditorneeded = false;
           } else {
               echo '<p align="right">';
               helpbutton('textformat', get_string('formattexttype'));
               print_string('formattexttype');
               echo ':&nbsp;';
               $format = (isset($categories[$i]->format)) ? $categories[$i]->format : $defaultformat ;
               choose_from_menu(format_text_menu(), 'format[]', @$categories[$i]->format , '');
               echo '</p>';
           }
        ?>
        </td>
    </tr>
    <tr valign="top">
        <td align="right"><b><?php print_string('categoryresult', 'magtest') ?>:</b></td>
        <td align="left">
        <?php
           print_textarea($usehtmleditor, 5, 60, 595, 400, 'result[]', @$categories[$i]->result);
    
           if ($usehtmleditor) {
               echo '<input type="hidden" name="format[]" value="'.FORMAT_HTML.'" />';
               $nohtmleditorneeded = false;
           } else {
               echo '<p align="right">';
               helpbutton('textformat', get_string('formattexttype'));
               print_string('resultformattexttypehelp', 'magtest');
               echo ':&nbsp;';
               echo '</p>';
           }
        ?>
        </td>
    </tr>
<?php
    if ($magtest->usemakegroups){
?>
    <tr valign="top">
        <td align="right"><b><?php print_string('outputgroupname', 'magtest') ?>:</b></td>
        <td align="left">
            <input type="text" name="outputgroupname[]" value="<?php echo @$categories[$i]->outputgroupname ?>" />
        </td>
    </tr>
    <tr valign="top">
        <td align="right"><b><?php print_string('outputgroupdesc', 'magtest') ?>:</b></td>
        <td align="left">
            <input type="text" name="outputgroupdesc[]" value="<?php echo @$categories[$i]->outputgroupdesc ?>" />
        </td>
    </tr>
<?php
    }
}
$onsubmit = '';
if ($usehtmleditor && @$CFG->defaulthtmleditor != 'tinymce'){
    $onsubmit = "document.forms['categories'].onsubmit();";
}
?>
    <tr>
        <td colspan="2" align="center">
            <input type="button" name="go_btn" value="<?php print_string('update') ?>" onclick="<?php echo $onsubmit ?>document.forms['categories'].submit();" />
            <input type="button" name="cancel_btn" value="<?php print_string('cancel') ?>" onclick="document.forms['categories'].what.value = '';document.forms['categories'].submit();" />
        </td>
    </tr>
</table>
</form>
</center>
<?php
print_box_end();
?>